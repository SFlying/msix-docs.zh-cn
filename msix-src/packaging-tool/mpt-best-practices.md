---
title: 适用于 MSIX 打包工具的最佳做法
description: 本文介绍适用于将应用重新打包到 MSIX 以及使用 MSIX 打包工具的最佳做法。
ms.date: 09/07/2018
ms.topic: article
keywords: windows 10, uwp, msix
ms.localizationpriority: medium
ms.custom: RS5
ms.openlocfilehash: 00c3831995383cea4b558c6353f4b545ae5b94ac
ms.sourcegitcommit: 0bd5ebc32feba8a4f4669f232129a8953d5cf773
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 01/15/2020
ms.locfileid: "76022010"
---
# <a name="best-practices-for-the-msix-packaging-tool"></a>适用于 MSIX 打包工具的最佳做法

<div class="nextstepaction"><p><a class="x-hidden-focus" href="https://www.microsoft.com/en-us/p/msix-packaging-tool/9n5lw3jbcxkf" data-linktype="external">获取 MSIX 打包工具</a></p></div>

本文介绍适用于将应用重新打包到 MSIX 以及使用 MSIX 打包工具的最佳做法。

## <a name="best-practices-for-environment-setup"></a>环境设置的最佳实践
 
请确保具有[最新版本的 .Msix 打包工具](mpt-overview.md#latest-public-version---1201912200)。 对于转换过程，我们建议你在开始之前考虑其他一些事项。

- .MSIX 打包工具的最低操作系统版本要求为 Windows 10 1809。 我们了解，并非每个人都用的是 Windows 10 2018 年 10 月更新或甚至是 Windows 10。 因此，我们建议你创建已预先配置为提供 MSIX 最低版支持的全新 VM。

- 用于转换的干净计算机很重要，因为在使用 .MSIX 打包工具进行转换的安装步骤中，我们将侦听计算机上的所有内容来捕获安装程序的功能，并将帮助防止软件包. 干净的计算机意味着在计算机上没有无关的应用或服务。 建议将转换计算机配置为模拟将运行 .MSIX 包的环境，因此，如果存在要在其中运行的服务或策略，则可以测试该包是否会实际工作。

- 如果这不是我们提供的 "**快速创建 VM**"，则可以在 hyper-v 中使用[.Msix 打包工具环境](quick-create-vm.md)，该环境可与 Windows 10 1809 和最新版本的 .msix 打包工具结合使用。 

- 遵循有关设置 .MSIX 打包工具的最佳实践建议，然后为 VM 创建检查点。 这样，你就可以使用 VM 来转换、还原到以前的检查点，并且它将是一个干净的配置计算机，可以再次进行转换或验证是否已成功转换 .MSIX 包。

- 此外，也最好知道你有哪一类型的依赖项，以便了解哪些依赖项应随应用运行，以及哪些依赖项应以修改包的形式打包。 例如，如果有运行时依赖项，那么最好将这些依赖项包含在主应用程序中。 如果你有一个插件，则应将其打包为一个修改包，以便与你的主应用程序相关联。 

## <a name="best-practices-for-setting-up-the-msix-packaging-tool"></a>设置 .MSIX 打包工具的最佳实践

在开始任何转换之前，建议在 .MSIX 打包工具中配置设置，以便每次简化工作流。 

### <a name="tool-defaults"></a>工具默认值
- **生成包含每个包的命令行**此设置将使你自动生成一个命令行文件，以便在稍后通过命令行重新打包同一应用程序（例如新版本）时，你可以为该应用程序预配置的命令行文件。 
- **默认情况下，选择 "准备计算机" 的所有修补程序**此设置允许你预先选择所有建议的修复程序，以便在 "准备计算机" 阶段，你只需选择禁用所有修复，无需单独选择它们。
- **强制实施 Microsoft Store 版本控制要求**如果打算通过 Microsoft Store 来部署应用程序，则应确保选中此选项，使其符合应用商店要求（这将影响包版本要求和最低操作系统版本支持）。 如果未选中此选项，则包的最低版本设置为 Windows 10 1709，你将对包版本4位数字具有完全控制。 如果选中此选项，则包的最低版本设置为 Windows 10 1809，版本必须以. 0 （例如1.5.6.0）结束。
- **生成包时添加包完整性**如果选择此选项，则包完整性将自动添加到生成的所有包中。 但是，它仅适用于在其上部署了包完整性的操作系统。 
- **默认保存位置**指定将保存生成的包和关联文件的默认保存位置。
- **默认安装程序浏览位置**指定用于查找要转换的安装程序的默认位置。
- **服务器端口号**指定 .MSIX 打包工具的服务器端口号。 如果你打算使用[远程计算机](https://docs.microsoft.com/windows/msix/packaging-tool/remote-conversion-setup)进行转换，则这一点很有用。 
- **环境首选项**指定每个转换的默认环境。
- **签名首选项**指定在转换应用程序时进行签名的默认选项。 需要对 .MSIX 包进行签名才能安装它。 你可以从几个选项中进行选择，以用于你的签名首选项。
    - 使用 Device Guard 签名签名-如果企业中没有受信任的证书，则建议使用此选项。 可在此处了解有关设置 Device Guard 签名的详细信息。 
    - 使用证书签名（.pfx）-如果已有在企业中使用的受信任证书，建议使用此选项。
    - 指定 .cer 文件（不签名）-如果不想在转换时进行签名，但要确保发布服务器信息在签名时有效，则可以选择此选项。
    - 不对包进行签名。 -如果你想要使用其他方法对包进行签名，或者稍后在生成包后进行签名，则可以选择此选项。

我们还建议你向 siging 首选项添加一个时间戳服务器 url （如果适用），以便即使你的证书过期也能安装应用程序。
 
 ### <a name="other-settings"></a>其他设置
 - **文件和注册表 exlusions**尽管我们有一组默认的排除项，但我们建议你根据特定需求查看并添加或删除任何排除项。 
 - **安装程序退出代码**如果要在转换过程中触发重启的特定安装程序退出代码，可以在此处指定这些代码。 默认情况下，我们已添加了常用文件，但如果你不希望触发重新启动，则可以将其删除。 请注意，如果您使用的是 UI，则打包工具将永远不会自动触发重新启动，但如果您使用的是命令行选项，则会重新启动。 
 
 你还可以使用这些[说明](https://docs.microsoft.com/windows/msix/packaging-tool/duplicate-mpt-settings-across-devices)导入或导出你的设置以便共享或确保对等方的符合性。 

## <a name="best-practices-during-repackaging"></a>重新打包过程中的最佳做法

使用 .MSIX 打包工具时，我们还建议你在重新打包过程中执行以下操作：

- 打包 ClickOnce 安装程序时，有必要将快捷方式发送到桌面（如果安装程序尚未执行该操作）。 一般情况下，始终记得为主应用可执行文件将快捷方式发送到桌面是很好的做法。
- 当创建修改包时，需要在工具 UI 中声明父应用程序的包名称（标识名称），以便该工具在修改包的清单中设置正确的包依赖项。
- 在 "**准备计算机**" 页中执行准备步骤是可选的，但强烈建议这样做，因为这将有助于减少包中的任何无关数据。 
- 需要对包进行签名以进行安装，但我们也建议您将证书加盖时间戳，以便即使证书过期也能安装应用程序。 
- "**包信息**" 页中的 "声明安装位置" 字段是可选的。 请确保此路径与应用程序安装程序的安装位置相匹配。

## <a name="best-practices-while-bundling-msix-packages"></a>捆绑 MSIX 包时的最佳做法

我们建议在应用程序有不同的安装程序可用于不同的处理器体系结构（如 x86、x64 和 ARM）时捆绑 MSIX 包。 通过将安装程序捆绑在一起，可以允许 Windows 10 OS 确定相应安装程序的适用性，而无需用户必须做出正确选择。 

[捆绑 .msix 包](https://docs.microsoft.com/windows/msix/packaging-tool/bundle-msix-packages)时，需要已将 Win32 安装程序转换为 .msix 包。 

- MSIX 打包工具将假定转换正在进行的 Windows 10 OS 版本的处理器体系结构。 例如，如果位于 x64 版的 Windows 10 上，并且要转换 x86 版的安装程序，那么生成的 MSIX 包将为 x64 版。 
- 如果计划捆绑 MSIX 包，则需要在应部署它们的同一环境中转换安装程序。 这样一来，MSIX 打包工具将生成适用于该环境的 MSIX 包。 

## <a name="best-practices-for-testing-your-msix-package"></a>测试 .MSIX 包的最佳实践

建议你在转换后，在干净的环境中（如我们在环境安装过程中指定的那样），测试 .MSIX 包。 你应在未安装上一个安装程序的其他计算机上测试 .MSIX 包，以便你可以确保部署 .MSIX 包时，它将具有所需的所有组件，并且不会从以前的安装程序中提取任何内容。 这可以通过新的 VM （如快速创建 VM）来实现，如果遵循上述的检查点建议，则可以通过恢复转换计算机来实现此目的。

